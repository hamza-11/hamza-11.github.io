<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø±Ø¯Ø´Ø©</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Almarai&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #075e54;
            --secondary-color: #25d366;
            --dark-bg: #111;
            --header-bg: #222;
            --message-bg: #333;
            --light-text: #bbb;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Almarai', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--dark-bg);
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--header-bg);
            color: white;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            flex-shrink: 0;
        }

        .header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .header button {
            background: #e53935;
            border: none;
            padding: 8px 14px;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            transition: background 0.3s;
        }

        .header button:hover {
            background: #c62828;
        }

        #chat {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #000;
            scroll-behavior: smooth;
        }

        .message {
            display: flex;
            margin-bottom: 12px;
            position: relative;
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message.received {
            justify-content: flex-start;
        }

        .bubble {
            max-width: 60%;
            padding: 12px 15px;
            border-radius: 15px;
            background-color: var(--message-bg);
            color: white;
            position: relative;
            word-break: break-word;
        }

        .message.sent .bubble {
            background-color: var(--primary-color);
        }

        .timestamp {
            font-size: 11px;
            color: var(--light-text);
            margin-top: 5px;
            text-align: left;
        }

        .reactions-container {
            display: flex;
            margin-top: 5px;
            flex-wrap: wrap;
            gap: 5px;
        }

        .reaction {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .reaction-count {
            font-size: 10px;
        }

        .reaction-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--header-bg);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }

        .message:hover .reaction-btn {
            opacity: 1;
        }

        .reaction-picker {
            position: absolute;
            background: var(--header-bg);
            border-radius: 20px;
            padding: 5px;
            display: flex;
            gap: 5px;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            top: -35px;
            right: 0;
        }

        .emoji-option {
            cursor: pointer;
            font-size: 18px;
            padding: 3px;
            transition: transform 0.2s;
        }

        .emoji-option:hover {
            transform: scale(1.2);
        }

        #messageInputContainer {
            background: var(--header-bg);
            padding: 12px;
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        #messageInput {
            flex: 1;
            padding: 12px;
            border-radius: 20px;
            border: none;
            background: var(--message-bg);
            color: white;
            font-family: 'Almarai', sans-serif;
        }

        #messageInput:focus {
            outline: 1px solid var(--secondary-color);
        }

        button {
            background: var(--secondary-color);
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            color: white;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
        }

        button:hover {
            background: #20b358;
        }

        img.chat-img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            margin-bottom: 5px;
            object-fit: cover;
        }

        .loading {
            text-align: center;
            padding: 10px;
            color: var(--light-text);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¯Ø§Ø¡ */
        .message {
            will-change: transform;
        }
        
        .bubble {
            will-change: transform;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-width: 768px) {
            .bubble {
                max-width: 80%;
            }
            
            .header {
                padding: 10px;
            }
            
            #messageInputContainer {
                padding: 10px;
            }
        }
    </style>
</head>
<body dir="rtl">

    <div class="header">
        <div style="display:flex;align-items:center;">
            <h2>Ø¯Ø±Ø¯Ø´Ø©</h2>
        </div>
        <button onclick="deleteChat()">Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
    </div>

    <div id="chat">
        <div class="loading" id="loadingIndicator">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</div>
    </div>

    <div id="messageInputContainer">
        <input id="messageInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="handleKeyPress(event)">
        <input id="imageInput" type="file" style="display:none" accept="image/*">
        <button onclick="document.getElementById('imageInput').click()">
            <i class="fas fa-camera"></i>
        </button>
        <button onclick="sendMessage()">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>

    <script>
        /* ---------------------- Firebase ---------------------- */
        const firebaseConfig = {
            apiKey: "AIzaSyByTnOxAhiNYbytuZV4pJT5Kwm6LcsSMzg",
            authDomain: "chatz-da38d.firebaseapp.com",
            databaseURL: "https://chatz-da38d-default-rtdb.firebaseio.com",
            projectId: "chatz-da38d",
            storageBucket: "chatz-da38d.appspot.com",
            messagingSenderId: "681805463840",
            appId: "1:681805463840:web:2b90061ef8a9d7dd7a9745"
        };

        firebase.initializeApp(firebaseConfig);
        const chatRef = firebase.database().ref("chat");

        const chatDiv = document.getElementById("chat");
        const loadingIndicator = document.getElementById("loadingIndicator");

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ Ù„ØªØ¬Ù†Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        let currentUser = localStorage.getItem('chatCurrentUser');
        if (!currentUser) {
            currentUser = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ");
            if (currentUser) {
                localStorage.setItem('chatCurrentUser', currentUser);
            } else {
                currentUser = "Ù…Ø³ØªØ®Ø¯Ù…";
            }
        }
        
        const otherUser = currentUser === "Ø­Ù…Ø²Ø©" ? "Ø­Ø¨ÙŠØ¨Ø©" : "Ø­Ù…Ø²Ø©";

        /* ---------------------- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ Ø§Ù„Ù…Ø­Ø³Ù† ---------------------- */
        let messages = [];
        let loadedCount = 20; // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹
        let isLoading = false;

        // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
        chatRef.orderByChild('timestamp').on("value", snapshot => {
            const newMessages = [];
            snapshot.forEach(child => {
                let msg = child.val();
                msg.id = child.key;
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø³Ù„ ÙˆØ§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
                if (
                    (msg.sender === currentUser && msg.receiver === otherUser) ||
                    (msg.sender === otherUser && msg.receiver === currentUser)
                ) {
                    newMessages.push(msg);
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¹ ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
            updateMessages(newMessages);
        });

        function updateMessages(newMessages) {
            // Ø¯Ù…Ø¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const messageMap = new Map();
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            messages.forEach(msg => messageMap.set(msg.id, msg));
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            newMessages.forEach(msg => messageMap.set(msg.id, msg));
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© ÙˆÙØ±Ø²Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ
            messages = Array.from(messageMap.values()).sort((a, b) => a.timestamp - b.timestamp);
            
            renderMessages();
            loadingIndicator.style.display = 'none';
        }

        function renderMessages() {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§
            let start = Math.max(messages.length - loadedCount, 0);
            let visible = messages.slice(start);
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø£ÙƒØ¨Ø± Ù…Ù…Ø§ Ù†Ø¹Ø±Ø¶Ù‡ØŒ Ø£Ø¶Ù Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            if (messages.length > loadedCount && start > 0) {
                const loadMoreDiv = document.createElement('div');
                loadMoreDiv.className = 'loading';
                loadMoreDiv.id = 'loadMoreIndicator';
                loadMoreDiv.textContent = 'ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯...';
                loadMoreDiv.onclick = loadMoreMessages;
                chatDiv.prepend(loadMoreDiv);
            } else {
                const existingIndicator = document.getElementById('loadMoreIndicator');
                if (existingIndicator) {
                    existingIndicator.remove();
                }
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø¦ÙŠØ© ÙÙ‚Ø·
            const fragment = document.createDocumentFragment();
            
            // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¦Ù‡Ø§
            chatDiv.innerHTML = '';
            
            // Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø¦ÙŠØ©
            visible.forEach(msg => {
                const messageElement = createMessageElement(msg);
                fragment.appendChild(messageElement);
            });
            
            chatDiv.appendChild(fragment);
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„
            const isScrolledToBottom = chatDiv.scrollHeight - chatDiv.clientHeight <= chatDiv.scrollTop + 100;
            if (isScrolledToBottom) {
                chatDiv.scrollTop = chatDiv.scrollHeight;
            }
        }

        function loadMoreMessages() {
            if (isLoading) return;
            
            isLoading = true;
            const indicator = document.getElementById('loadMoreIndicator');
            if (indicator) {
                indicator.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            }
            
            // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ù…Ù„Ø©
            loadedCount += 10;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø© Ù„Ù…Ù†Ø¹ ØªØ¬Ù…ÙŠØ¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            setTimeout(() => {
                renderMessages();
                isLoading = false;
            }, 100);
        }

        /* ---------------------- Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª ---------------------- */
        function createMessageElement(msg) {
            const div = document.createElement("div");
            div.className = "message " + (msg.sender === currentUser ? "sent" : "received");
            div.dataset.messageId = msg.id;

            const bubble = document.createElement("div");
            bubble.className = "bubble";

            if (msg.image) {
                let image = document.createElement("img");
                image.src = msg.image;
                image.className = "chat-img";
                image.loading = "lazy"; // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
                bubble.appendChild(image);
            }

            if (msg.text) {
                let text = document.createElement("p");
                text.textContent = msg.text;
                bubble.appendChild(text);
            }

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (msg.reactions && Object.keys(msg.reactions).length > 0) {
                const reactionsContainer = document.createElement("div");
                reactionsContainer.className = "reactions-container";
                
                Object.entries(msg.reactions).forEach(([emoji, users]) => {
                    if (users && users.length > 0) {
                        const reaction = document.createElement("div");
                        reaction.className = "reaction";
                        reaction.innerHTML = `${emoji} <span class="reaction-count">${users.length}</span>`;
                        reactionsContainer.appendChild(reaction);
                    }
                });
                
                if (reactionsContainer.children.length > 0) {
                    bubble.appendChild(reactionsContainer);
                }
            }

            let time = document.createElement("div");
            time.className = "timestamp";
            time.textContent = new Date(msg.timestamp).toLocaleString('ar-SA');
            bubble.appendChild(time);

            // Ø²Ø± Ø¥Ø¶Ø§ÙØ© ØªÙØ§Ø¹Ù„
            const reactionBtn = document.createElement("button");
            reactionBtn.className = "reaction-btn";
            reactionBtn.innerHTML = '<i class="far fa-smile"></i>';
            reactionBtn.onclick = (e) => {
                e.stopPropagation();
                showReactionPicker(msg.id, reactionBtn);
            };
            bubble.appendChild(reactionBtn);

            div.appendChild(bubble);
            return div;
        }

        /* ---------------------- Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ---------------------- */
        function showReactionPicker(messageId, button) {
            // Ø¥Ø²Ø§Ù„Ø© Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            const existingPicker = document.querySelector('.reaction-picker');
            if (existingPicker) {
                existingPicker.remove();
                return;
            }

            const emojis = ['ğŸ‘', 'â¤ï¸', 'ğŸ˜‚', 'ğŸ˜®', 'ğŸ˜¢', 'ğŸ™'];
            const picker = document.createElement("div");
            picker.className = "reaction-picker";

            emojis.forEach(emoji => {
                const emojiOption = document.createElement("span");
                emojiOption.className = "emoji-option";
                emojiOption.textContent = emoji;
                emojiOption.onclick = (e) => {
                    e.stopPropagation();
                    addReaction(messageId, emoji);
                    picker.remove();
                };
                picker.appendChild(emojiOption);
            });

            // ÙˆØ¶Ø¹ Ø§Ù„Ù…Ù†ØªÙ‚ÙŠ Ø¨Ø§Ù„Ù‚Ø±Ø¨ Ù…Ù† Ø§Ù„Ø²Ø±
            const rect = button.getBoundingClientRect();
            picker.style.position = 'fixed';
            picker.style.top = `${rect.top - 40}px`;
            picker.style.right = `${window.innerWidth - rect.right}px`;
            
            document.body.appendChild(picker);

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù†ØªÙ‚ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¢Ø®Ø±
            setTimeout(() => {
                const closePicker = (e) => {
                    if (!picker.contains(e.target) && e.target !== button) {
                        picker.remove();
                        document.removeEventListener('click', closePicker);
                    }
                };
                document.addEventListener('click', closePicker);
            }, 0);
        }

        /* ---------------------- Ø¥Ø¶Ø§ÙØ© ØªÙØ§Ø¹Ù„ ---------------------- */
        function addReaction(messageId, emoji) {
            const messageRef = firebase.database().ref(`chat/${messageId}`);
            
            messageRef.once('value').then(snapshot => {
                const message = snapshot.val();
                if (!message) return;
                
                let reactions = message.reactions || {};
                
                if (!reactions[emoji]) {
                    reactions[emoji] = [];
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø¶Ø§ÙØ§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„
                if (!reactions[emoji].includes(currentUser)) {
                    reactions[emoji].push(currentUser);
                } else {
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¶Ø§ÙØ§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„ (ØªØ¨Ø¯ÙŠÙ„)
                    reactions[emoji] = reactions[emoji].filter(user => user !== currentUser);
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¹Ø¯ Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                    if (reactions[emoji].length === 0) {
                        delete reactions[emoji];
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                messageRef.update({ reactions });
            }).catch(error => {
                console.error('Error adding reaction:', error);
            });
        }

        /* ---------------------- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ---------------------- */
        document.getElementById("imageInput").addEventListener("change", e => {
            let file = e.target.files[0];
            if (!file) return;
            
            let reader = new FileReader();
            reader.onload = function(ev) {
                pushMessage(null, ev.target.result);
                e.target.value = ''; // Ù…Ø³Ø­ Ø§Ù„Ù…Ø¯Ø®Ù„ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ù…ÙŠÙ„ Ù†ÙØ³ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            };
            reader.readAsDataURL(file);
        });

        function sendMessage() {
            let text = document.getElementById("messageInput").value.trim();
            if (text !== "") {
                pushMessage(text, null);
                document.getElementById("messageInput").value = "";
            }
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        }

        function pushMessage(text, image) {
            chatRef.push({
                text,
                image,
                sender: currentUser,
                receiver: otherUser,
                timestamp: Date.now(),
                reactions: {}
            });
        }

        /* ---------------------- Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ---------------------- */
        function deleteChat() {
            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ")) {
                chatRef.remove();
                messages = [];
                chatDiv.innerHTML = '<div class="loading" id="loadingIndicator">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</div>';
                loadingIndicator.style.display = 'block';
            }
        }
    </script>
</body>
</html>
